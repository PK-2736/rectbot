name = "rectbot-backend"
account_id = "74749d85b9c280c0daa93e12ea5d5a14"
route = "https://api.recrubo.net/*"  # Custom Domainを使用
main = "index.js"
compatibility_date = "2025-09-11"
# workers_dev = true  # 本番ではコメントアウト

# Trigger redeploy by adding this comment

# KVは使用しないため削除
# kv_namespaces は削除済み

# Durable Objects 設定
[durable_objects]
bindings = [
	{ name = "RECRUITS_DO", class_name = "RecruitsDO" },
	{ name = "INVITE_TOKENS_DO", class_name = "InviteTokensDO" }
]

[[migrations]]
tag = "v1-recruits-do"
new_sqlite_classes = ["RecruitsDO"]

[[migrations]]
tag = "v2-invite-tokens-do"
new_sqlite_classes = ["InviteTokensDO"]

# Friend Code Management - D1 Database
[[d1_databases]]
binding = "FRIEND_CODE_DB"
database_name = "friendcodes"
database_id = "9812daf1-55a9-4cdd-b924-f4b9adcd65b1"

# Friend Code Management - Vectorize for game name similarity
[[vectorize]]
binding = "VECTORIZE"
index_name = "game-names"

# Workers AI binding for LLM and embeddings
[ai]
binding = "AI"

# 環境変数は GitHub Actions で動的に設定されます
[vars]
# これらの変数はデプロイ時にGitHub Actionsから --var で上書きされます
DISCORD_CLIENT_ID = "1048950201974542477"
DISCORD_REDIRECT_URI = "https://app.recrubo.net/auth/callback"
PUBLIC_RECAPTCHA_SITE_KEY = "placeholder"
ADMIN_DISCORD_ID = "placeholder"
VPS_EXPRESS_URL = "http://localhost:3001"
# SUPABASE_URL は wrangler secret put で設定されるため [vars] から削除
# シークレットは wrangler secret put コマンドで設定されます:
# - DISCORD_CLIENT_SECRET
# - SUPABASE_URL (secretとして永続化)
# - SUPABASE_SERVICE_ROLE_KEY (機密情報なのでsecretとして設定)
# - JWT_PUBLIC_KEY
# - JWT_ISSUER_URL
# - SERVICE_JWT_PUBLIC_KEY
# - SERVICE_TOKEN
# - SENTRY_DSN
# - SUPPORT_EMAIL
# - DISCORD_WEBHOOK_URL
# - RECAPTCHA_SECRET
# - MAILCHANNELS_API_KEY
# - GRAFANA_TOKEN